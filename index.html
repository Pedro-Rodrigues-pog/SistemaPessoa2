<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pessoas</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #painel {
            display: none;
        }
        #inicio {
            display: block;
        }
    </style>
</head>
<body>
    <div id="inicio">

        <h1>Login</h1>

        <p>CPF:<input type="text" id="cpflogin"></p><br>
        <p>Senha:<input type="text" id="senhalogin"></p><br>

        <p><button onclick="logar()">Logar</button></p>
        
        <h1>Criar Conta</h1>

        <p>Nome:<input type ="text" id="nomecriar"</p><br>
        <p>CPF:<input type="text" id="cpfcriar"></p><br>
        <p>Contato:<input type="text" id="contatocriar"></p><br>
        <p>Senha:<input type="text" id="senhacriar"></p><br>

        <p><button onclick="criarConta()">Criar</button></p>
        <p id="rescriar"></p> 

    </div>

    <div id="painel">

        <h1>Agendar</h1>

        <p>CPF:<input type="text" id="cpfagenda"></p><br>
        <p>Data:<input type="date" id="data"></p><br>
        <p>Descrição:<input type="text" id="descricao"></p><br>

        <p><button onclick="agendar()">Agendar</button></p>
        <p><button onclick="atualizarAgenda()">Atualizar Agenda</button></p>
        <p><button onclick="consultarAgenda()">Consultar Agenda</button></p>
        <p><button onclick="apagarAgenda()">Apagar Agenda</button></p>

        <p id="res"></p>

    </div>

    <script>

        function logar() {
            var cpf = document.getElementById("cpflogin").value
            var senha = document.getElementById("senhalogin").value
            var requisicao = new XMLHttpRequest();  
            
            var requisicao = new XMLHttpRequest();//Requisição HTML
            requisicao.open("GET", "controllerPessoa.php?cpf=" + cpf + "&senha=" + senha + "&acao=validaPessoa");
            requisicao.send();

            requisicao.onload = function(){
                var organizacao=JSON.parse(this.responseText);
                if(organizacao.length>0){
                    document.getElementById("inicio").style.display="none";
                    document.getElementById("painel").style.display="block";
                }
            }
        }
        
        function criarConta(){
            var cpf = document.getElementById("cpfcriar").value  
            var nome = document.getElementById("nomecriar").value  
            var contato = document.getElementById("contatocriar").value  
            var senha = document.getElementById("senhacriar").value  
           
            var requisicao = new XMLHttpRequest();
            requisicao.open("POST","controllerPessoa.php?cpf="+cpf+"&nome="+nome+"&contato="+contato+"&senha="+senha+"&acao=inserir")
            requisicao.send();
            requisicao.onload= function(){
                document.getElementById("rescriar").innerHTML = this.responseText;
            }
        }
       
        function agendar(){
            var cpf = document.getElementById("cpfagenda").value  
            var data = document.getElementById("data").value  
            var descricao = document.getElementById("descricao").value  
           
            var requisicao = new XMLHttpRequest();
            requisicao.open("POST","controllerAgenda.php?cpf="+cpf+"&data="+data+"&descricao="+descricao+"&acao=inserir")
            requisicao.send();

            requisicao.onload= function(){
                document.getElementById("res").innerHTML = this.responseText;
            }
        }

        function atualizarAgenda(){
            var cpf = document.getElementById("cpfagenda").value  
            var data = document.getElementById("data").value  
            var descricao = document.getElementById("descricao").value  
           
            var requisicao = new XMLHttpRequest();
            requisicao.open("POST","controllerAgenda.php?cpf="+cpf+"&data="+data+"&descricao="+descricao+"&acao=atualizar")
            requisicao.send();

            requisicao.onload= function(){
                document.getElementById("res").innerHTML = this.responseText;
            }
        }

        function consultarAgenda(){
            var requisicao = new XMLHttpRequest();

            requisicao.open("GET","controllerAgenda.php?acao=consultar")
            requisicao.send();
            requisicao.onload= function(){
                var organizacao = JSON.parse(this.responseText);
                var resposta = "";

                for (let i = 0; i < organizacao.length; i++) {
                    resposta +=
                    "<br>Codigo: " + (i + 1) +
                    "<br>Nome: " + organizacao[i].nome +
                    "<br>CPF: " + organizacao[i].cpf +
                    "<br>Data: " + organizacao[i].data +
                    "<br>Descrição: " + organizacao[i].descricao + "<br>";
                }
                document.getElementById("res").innerHTML = resposta;
            }
        }

        function apagarAgenda(){
            var cpf = document.getElementById("cpfagenda").value  
            var data = document.getElementById("data").value  
            var descricao = document.getElementById("descricao").value  
           
            var requisicao = new XMLHttpRequest();
            requisicao.open("POST","controllerAgenda.php?cpf="+cpf+"&data="+data+"&descricao="+descricao+"&acao=apagar")
            requisicao.send();

            requisicao.onload= function(){
                document.getElementById("res").innerHTML = this.responseText;
            }
        }
        bot.onclick = consulta;
    </script>
</body>
</html>
